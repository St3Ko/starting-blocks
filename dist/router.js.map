{"version":3,"sources":["router.js"],"names":[],"mappings":"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","file":"router.js","sourcesContent":["/**\n * Copyright Â© 2016, Ambroise Maupate\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is furnished\n * to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * @file router.js\n * @author Ambroise Maupate\n */\nimport $ from \"jquery\";\nimport {State} from \"state\";\nimport {Home} from \"pages/home\";\n\nexport class Router {\n    /**\n     * Create a new Router.\n     *\n     * Default options list:\n     *\n     * * homeHasClass: false,\n     * * ajaxEnabled: true,\n     * * pageClass: \"page-content\", (Without point!)\n     * * objectTypeAttr: \"data-node-type\",\n     * * noAjaxLinkClass: \"no-ajax-link\",\n     * * navLinkClass: \"nav-link\",\n     * * activeClass: \"active\",\n     * * pageBlockClass: \".page-block\", (With point!)\n     * * $ajaxContainer: $(\"#ajax-container\"),\n     * * lazyloadEnabled: false,\n     * * lazyloadSrcAttr: 'data-src',\n     * * lazyloadClass: 'lazyload',\n     * * lazyloadSrcSetAttr: 'data-src-set',\n     * * minLoadDuration: 0,\n     * * postLoad: (state, data) => {},\n     * * preLoad: (state) => {},\n     * * preLoadPageDelay: 0\n     * * prePushState: (state) => {},\n     * * onDestroy: () => {},\n     * * preBoot: ($cont, context, isHome) => {},\n     *\n     *\n     * @param {Object} options\n     * @param {ClassFactory} classFactory\n     * @param {String} baseUrl\n     * @param {GraphicLoader} loader\n     * @param {AbstractNav} nav\n     */\n    constructor(options, classFactory, baseUrl, loader, nav) {\n        if (!baseUrl) {\n            throw \"Router needs baseUrl to be defined.\";\n        }\n        if (!loader) {\n            throw \"Router needs a GraphicLoader instance to be defined.\";\n        }\n        if (!classFactory) {\n            throw \"Router needs a ClassFactory instance to be defined.\";\n        }\n        if (!nav) {\n            throw \"Router needs a Nav instance to be defined.\";\n        }\n\n        /**\n         * @type {ClassFactory}\n         */\n        this.classFactory = classFactory;\n        /**\n         * @type {String}\n         */\n        this.baseUrl = baseUrl;\n        /**\n         * @type {GraphicLoader}\n         */\n        this.loader = loader;\n        /**\n         * @type {AbstractNav}\n         */\n        this.nav = nav;\n        /**\n         * @type {State|null}\n         */\n        this.state = null;\n        /**\n         * @type {Array}\n         */\n        this.formerPages = [];\n        /**\n         * @type {null}\n         */\n        this.page = null;\n        this.stateBlock = true;\n        this.ajaxEnabled = true;\n        this.transition = false;\n        this.loading = false;\n        this.$window = $(window);\n        /**\n         * @deprecated use this.$window instead\n         */\n        this.window = this.$window;\n        this.currentRequest = null;\n        /**\n         * @type {Object}\n         */\n        this.options = {\n            homeHasClass: false,\n            ajaxEnabled: true,\n            pageClass: \"page-content\",\n            objectTypeAttr: \"data-node-type\",\n            noAjaxLinkClass: \"no-ajax-link\",\n            navLinkClass: \"nav-link\",\n            activeClass: \"active\",\n            pageBlockClass: \".page-block\",\n            lazyloadEnabled: false,\n            lazyloadSrcAttr: 'data-src',\n            lazyloadClass: 'lazyload',\n            lazyloadSrcSetAttr: 'data-src-set',\n            $ajaxContainer: $(\"#ajax-container\"),\n            minLoadDuration: 0,\n            preLoadPageDelay: 0,\n            postLoad: (state, data) => {},\n            preLoad: (state) => {},\n            prePushState: (state) => {},\n            onDestroy: () => {},\n            preBoot: ($cont, context, isHome) => {}\n        };\n\n        if (options !== null) {\n            this.options = $.extend(this.options, options);\n        }\n    }\n\n    destroy() {\n        if (this.options.ajaxEnabled) {\n            window.removeEventListener(\"popstate\", this.onPopState.bind(this), false);\n        }\n        const onDestroyBinded = this.options.onDestroy.bind(this);\n        onDestroyBinded();\n    }\n\n    initEvents() {\n        if (this.options.ajaxEnabled) {\n            window.addEventListener(\"popstate\", this.onPopState.bind(this), false);\n        }\n        /*\n         * Init nav events\n         */\n        this.nav.initEvents(this);\n    }\n\n    onPopState(event) {\n        if (typeof event.state !== \"undefined\" && event.state !== null) {\n            this.transition = true;\n            this.loadPage(event, event.state);\n        }\n    }\n\n    /**\n     * Booting need a jQuery handler for\n     * the container.\n     *\n     * @param  {jQuery}  $cont\n     * @param  {String}  context\n     * @param  {Boolean} isHome\n     */\n    boot($cont, context, isHome) {\n        if(context == 'static') {\n            this.loadBeginDate = new Date();\n        }\n        const preBootBinded = this.options.preBoot.bind(this);\n        preBootBinded($cont, context, isHome);\n\n        const nodeType = $cont.attr(this.options.objectTypeAttr);\n\n        if(isHome && this.options.homeHasClass){\n            this.page = new Home(this, $cont, context, nodeType, isHome);\n        } else {\n            this.page = this.classFactory.getPageInstance(nodeType, this, $cont, context, nodeType, isHome);\n        }\n    }\n\n    /**\n     *\n     * @param e Event\n     */\n    onLinkClick(e) {\n        const linkClassName = e.currentTarget.className,\n            linkHref = e.currentTarget.href;\n\n        if(linkHref.indexOf('mailto:') == -1) {\n            e.preventDefault();\n\n            // Check if link is not active\n            if(linkClassName.indexOf(this.options.activeClass) == -1 &&\n               linkClassName.indexOf(this.options.noAjaxLinkClass) == -1 &&\n               !this.transition) {\n                this.transition = true;\n\n                this.state = new State(this, e.currentTarget, {\n                    previousType: this.page.type,\n                    navLinkClass: this.options.navLinkClass\n                });\n\n                const prePushStateBinded = this.options.prePushState.bind(this);\n                prePushStateBinded(this.state);\n\n                if (history.pushState) {\n                    history.pushState(this.state, this.state.title, this.state.href);\n                }\n                this.loadPage(e, this.state);\n            }\n        }\n    }\n\n    /**\n     *\n     * @param e\n     * @param state\n     */\n    loadPage(e, state) {\n        if(this.currentRequest && this.currentRequest.readyState != 4) {\n            this.currentRequest.abort();\n        }\n        this.loader.show();\n        this.loadBeginDate = new Date();\n\n        const preLoadBinded = this.options.preLoad.bind(this);\n        preLoadBinded(state);\n\n        setTimeout( () => {\n\n            this.currentRequest = $.ajax({\n                url: state.href,\n                dataType: \"html\",\n                // Need to disable cache to prevent\n                // browser to serve partial when no\n                // ajax context is defined.\n                cache: false,\n                type: 'get',\n                success: (data) => {\n                    // Extract only to new page content\n                    // if the whole HTML is queried\n                    let $data = null;\n                    const $response = $($.parseHTML(data.trim()));\n                    if ($response.hasClass(this.options.pageClass)) {\n                        $data = $response;\n                    } else {\n                        $data = $response.find('.' + this.options.pageClass);\n                    }\n                    /*\n                     * Display data to DOM\n                     */\n                    this.options.$ajaxContainer.append($data);\n\n                    /*\n                     * Push a copy object not to set it as null.\n                     */\n                    this.formerPages.push(this.page);\n\n                    // Init new page\n                    this.updatePageTitle($data);\n                    this.boot($data, 'ajax', state.isHome);\n\n                    const postLoadBinded = this.options.postLoad.bind(this);\n                    postLoadBinded(state, $data);\n\n                    // Analytics\n                    if(typeof ga !== \"undefined\") {\n                        ga('send', 'pageview', {'page':state.href, 'title':document.title});\n                    }\n                }\n            });\n\n        }, this.options.preLoadPageDelay);\n    }\n\n    /**\n     * Update page title against data-title attribute\n     * from ajax loaded partial DOM.\n     *\n     * @param {jQuery} $data\n     */\n    updatePageTitle($data){\n        if($data.length && $data.attr('data-meta-title') !== ''){\n            let metaTitle = $data.attr('data-meta-title');\n            if(metaTitle !== null && metaTitle !== '') document.title = metaTitle;\n        }\n    }\n\n    /**\n     *\n     * @param {boolean} isHome\n     */\n    pushFirstState(isHome){\n        if (history.pushState) {\n            history.pushState({\n                'firstPage': true,\n                'href':  window.location.href,\n                'isHome':isHome\n            }, null, window.location.href);\n        }\n    }\n}\n"],"sourceRoot":"/source/"}