{"version":3,"sources":["router.js"],"names":[],"mappings":"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","file":"router.js","sourcesContent":["/**\n * Copyright © 2016, Ambroise Maupate\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is furnished\n * to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * @file router.js\n * @author Ambroise Maupate\n */\nimport $ from \"jquery\";\nimport {State} from \"state\";\nimport {Home} from \"pages/home\";\nimport {AbstractPage} from \"abstract-page\";\nimport {GraphicLoader} from \"graphicLoader\";\nimport {AbstractNav} from \"abstract-nav\";\n\nexport class Router {\n    /**\n     * Create a new Router.\n     *\n     * Default options list: \n     *\n     * * homeHasClass: false,\n     * * ajaxEnabled: true,\n     * * pageClass: \"page-content\",\n     * * noAjaxLinkClass: \"no-ajax-link\",\n     * * navLinkClass: \"nav-link\",\n     * * activeClass: \"active\",\n     * * pageBlockClass: \".page-block\",\n     * * $ajaxContainer: $(\"#ajax-container\"),\n     * * minLoadDuration: 0,\n     * * postLoad: (state, data) => {},\n     * * preLoad: (state) => {},\n     * * prePushState: (state) => {},\n     * * onDestroy: () => {},\n     * * preBoot: ($cont, context, isHome) => {},\n     *\n     * Routes example:\n     *\n     * ```js\n     * {\n     *    'page' : Page,\n     * }\n     * ```\n     *\n     * @param {Object} options\n     * @param {Object} routes\n     * @param {String} baseUrl\n     * @param {GraphicLoader} loader\n     * @param {AbstractNav} nav\n     */\n    constructor(options, routes, baseUrl, loader, nav) {\n        if (!baseUrl) {\n            throw \"Router needs baseUrl to be defined.\";\n        }\n        if (!loader) {\n            throw \"Router needs a GraphicLoader instance to be defined.\";\n        }\n        if (!(loader instanceof GraphicLoader)) {\n            throw \"'loader' must be an instance of GraphicLoader.\";\n        }\n\n        if (!nav) {\n            throw \"Router needs a Nav instance to be defined.\";\n        }\n        if (!(nav instanceof AbstractNav)) {\n            throw \"'nav' must be an instance of Nav.\";\n        }\n\n        /**\n         * @type {String}\n         */\n        this.baseUrl = baseUrl;\n        /**\n         * @type {Object}\n         */\n        this.routes = routes;\n        /**\n         * @type {GraphicLoader}\n         */\n        this.loader = loader;\n        /**\n         * @type {AbstractNav}\n         */\n        this.nav = nav;\n        /**\n         * @type {State|null}\n         */\n        this.state = null;\n        /**\n         * @type {Array}\n         */\n        this.formerPages = [];\n        /**\n         * @type {null}\n         */\n        this.page = null;\n        this.stateBlock = true;\n        this.ajaxEnabled = true;\n        this.transition = false;\n        this.loading = false;\n        this.window = $(window);\n        this.currentRequest = null;\n        /**\n         * @type {Object}\n         */\n        this.options = {\n            homeHasClass: false,\n            ajaxEnabled: true,\n            pageClass: \"page-content\",\n            noAjaxLinkClass: \"no-ajax-link\",\n            navLinkClass: \"nav-link\",\n            activeClass: \"active\",\n            pageBlockClass: \".page-block\",\n            $ajaxContainer: $(\"#ajax-container\"),\n            minLoadDuration: 0,\n            postLoad: (state, data) => {},\n            preLoad: (state) => {},\n            prePushState: (state) => {},\n            onDestroy: () => {},\n            preBoot: ($cont, context, isHome) => {},\n        };\n\n        if (options !== null) {\n            this.options = $.extend(this.options, options);\n        }\n    }\n\n    destroy() {\n        if (this.options.ajaxEnabled) {\n            window.removeEventListener(\"popstate\", this.onPopState.bind(this), false);\n        }\n        const onDestroyBinded = this.options.onDestroy.bind(this);\n        onDestroyBinded();\n    }\n\n    initEvents() {\n        if (this.options.ajaxEnabled) {\n            window.addEventListener(\"popstate\", this.onPopState.bind(this), false);\n        }\n        /*\n         * Init nav events\n         */\n        this.nav.initEvents(this);\n    }\n\n    onPopState(event) {\n        console.log(this);\n        if (typeof event.state !== \"undefined\" && event.state !== null) {\n            this.transition = true;\n            this.loadPage(event, event.state);\n        }\n    }\n\n    /**\n     * Booting need a jQuery handler for\n     * the container.\n     *\n     * @param  {jQuery}  $cont\n     * @param  {String}  context\n     * @param  {Boolean} isHome\n     */\n    boot($cont, context, isHome) {\n        if(context == 'static') {\n            this.loadBeginDate = new Date();\n        }\n        const preBootBinded = this.options.preBoot.bind(this);\n        preBootBinded($cont, context, isHome);\n\n        const nodeType = $cont.attr('data-node-type');\n\n        if(isHome && this.options.homeHasClass){\n            this.page = new Home(this, $cont, context, nodeType, isHome);\n        } else if(nodeType && typeof this.routes[nodeType] !== 'undefined') {\n            this.page = new this.routes[nodeType](this, $cont, context, nodeType, isHome);\n        } else {\n            console.log('Page (' + nodeType + ') has no defined route, using AbstractPage.');\n            this.page = new AbstractPage(this, $cont, context, nodeType, isHome);\n        }\n    }\n\n    /**\n     *\n     * @param e Event\n     */\n    onLinkClick(e) {\n        const linkClassName = e.currentTarget.className,\n            linkHref = e.currentTarget.href;\n\n        if(linkHref.indexOf('mailto:') == -1) {\n            e.preventDefault();\n\n            // Check if link is not active\n            if(linkClassName.indexOf(this.options.activeClass) == -1 &&\n               linkClassName.indexOf(this.options.noAjaxLinkClass) == -1 &&\n               !this.transition) {\n                this.transition = true;\n\n                const state = new State(e.currentTarget, {\n                    previousType: this.page.type,\n                    navLinkClass: this.options.navLinkClass,\n                });\n\n                const prePushStateBinded = this.options.prePushState.bind(this);\n                prePushStateBinded(state);\n\n                history.pushState(state, state.title, state.href);\n                this.loadPage(e, state);\n            }\n        }\n    }\n\n    /**\n     *\n     * @param e\n     * @param state\n     */\n    loadPage(e, state) {\n        if(this.currentRequest && this.currentRequest.readyState != 4) {\n            this.currentRequest.abort();\n        }\n        this.loader.show();\n        this.loadBeginDate = new Date();\n\n        const preLoadBinded = this.options.preLoad.bind(this);\n        preLoadBinded(state);\n\n        this.currentRequest = $.ajax({\n            url: state.href,\n            dataType: \"html\",\n            // Need to disable cache to prevent\n            // browser to serve partial when no\n            // ajax context is defined.\n            cache: false,\n            type: 'get',\n            success: (data) => {\n                // Extract only to new page content\n                // if the whole HTML is queried\n                let $data = null;\n                const $response = $($.parseHTML(data.trim()));\n                if ($response.hasClass(this.options.pageClass)) {\n                    $data = $response;\n                } else {\n                    $data = $response.find('.' + this.options.pageClass);\n                }\n                /*\n                 * Display data to DOM\n                 */\n                this.options.$ajaxContainer.append($data);\n\n                /*\n                 * Push a copy object not to set it as null.\n                 */\n                this.formerPages.push(this.page);\n\n                // Init new page\n                this.updatePageTitle($data);\n                this.boot($data, 'ajax', state.isHome);\n\n                const postLoadBinded = this.options.postLoad.bind(this);\n                postLoadBinded(state, $data);\n\n                // Analytics\n                if(typeof ga !== \"undefined\") {\n                    ga('send', 'pageview', {'page':state.href, 'title':document.title});\n                }\n            }\n        });\n    }\n\n    /**\n     * Update page title against data-title attribute\n     * from ajax loaded partial DOM.\n     *\n     * @param {jQuery} $data\n     */\n    updatePageTitle($data){\n        if($data.length && $data.attr('data-meta-title') !== ''){\n            let metaTitle = $data.attr('data-meta-title');\n            if(metaTitle !== null && metaTitle !== '') document.title = metaTitle;\n        }\n    }\n\n    /**\n     *\n     * @param {boolean} isHome\n     */\n    pushFirstState(isHome){\n        history.pushState({\n            'firstPage': true,\n            'href':  window.location.href,\n            'isHome':isHome\n        }, null, window.location.href);\n    }\n}\n"],"sourceRoot":"/source/"}