{"version":3,"sources":["router.js"],"names":["Router","options","classFactory","baseUrl","loader","nav","state","formerPages","page","stateBlock","ajaxEnabled","transition","loading","$window","window","currentRequest","homeHasClass","pageClass","objectTypeAttr","noAjaxLinkClass","navLinkClass","activeClass","pageBlockClass","lazyloadEnabled","lazyloadSrcAttr","lazyloadClass","lazyloadSrcSetAttr","$ajaxContainer","minLoadDuration","preLoadPageDelay","postLoad","data","preLoad","prePushState","onDestroy","preBoot","$cont","context","isHome","extend","destroy","removeEventListener","onPopState","bind","onDestroyBinded","initEvents","addEventListener","event","loadPage","boot","loadBeginDate","Date","preBootBinded","nodeType","attr","getPageInstance","onLinkClick","e","linkClassName","currentTarget","className","linkHref","href","indexOf","preventDefault","previousType","type","prePushStateBinded","history","pushState","title","readyState","abort","show","preLoadBinded","setTimeout","ajax","url","dataType","cache","success","_onDataLoaded","$data","$response","parseHTML","trim","hasClass","find","append","push","updatePageTitle","postLoadBinded","ga","document","length","metaTitle","pushFirstState","location"],"mappings":"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","file":"router.js","sourcesContent":["/**\n * Copyright Â© 2016, Ambroise Maupate\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is furnished\n * to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * @file router.js\n * @author Ambroise Maupate\n */\nimport $ from \"jquery\";\nimport {State} from \"state\";\nimport {Home} from \"pages/home\";\n\nexport class Router {\n    /**\n     * Create a new Router.\n     *\n     * Default options list:\n     *\n     * * `homeHasClass`: false,\n     * * `ajaxEnabled`: true,\n     * * `pageClass`: \"page-content\", (Without point!)\n     * * `objectTypeAttr`: \"data-node-type\",\n     * * `noAjaxLinkClass`: \"no-ajax-link\",\n     * * `navLinkClass`: \"nav-link\",\n     * * `activeClass`: \"active\",\n     * * `pageBlockClass`: \".page-block\", (With point!)\n     * * `$ajaxContainer`: $(\"#ajax-container\"),\n     * * `lazyloadEnabled`: false,\n     * * `lazyloadSrcAttr`: 'data-src',\n     * * `lazyloadClass`: 'lazyload',\n     * * `lazyloadSrcSetAttr`: 'data-src-set',\n     * * `minLoadDuration`: 0,\n     * * `postLoad`: (state, data) => {},\n     * * `preLoad`: (state) => {},\n     * * `preLoadPageDelay`: 0\n     * * `prePushState`: (state) => {},\n     * * `onDestroy`: () => {},\n     * * `preBoot`: ($cont, context, isHome) => {},\n     *\n     *\n     * @param {Object} options\n     * @param {ClassFactory} classFactory\n     * @param {String} baseUrl\n     * @param {GraphicLoader} loader\n     * @param {AbstractNav} nav\n     */\n    constructor(options, classFactory, baseUrl, loader, nav) {\n        if (!baseUrl) {\n            throw \"Router needs baseUrl to be defined.\";\n        }\n        if (!loader) {\n            throw \"Router needs a GraphicLoader instance to be defined.\";\n        }\n        if (!classFactory) {\n            throw \"Router needs a ClassFactory instance to be defined.\";\n        }\n        if (!nav) {\n            throw \"Router needs a Nav instance to be defined.\";\n        }\n\n        /**\n         * @type {ClassFactory}\n         */\n        this.classFactory = classFactory;\n        /**\n         * @type {String}\n         */\n        this.baseUrl = baseUrl;\n        /**\n         * @type {GraphicLoader}\n         */\n        this.loader = loader;\n        /**\n         * @type {AbstractNav}\n         */\n        this.nav = nav;\n        /**\n         * @type {State|null}\n         */\n        this.state = null;\n        /**\n         * @type {Array}\n         */\n        this.formerPages = [];\n        /**\n         * @type {null}\n         */\n        this.page = null;\n        this.stateBlock = true;\n        this.ajaxEnabled = true;\n        this.transition = false;\n        this.loading = false;\n        this.$window = $(window);\n        /**\n         * @deprecated use this.$window instead\n         */\n        this.window = this.$window;\n        this.currentRequest = null;\n        /**\n         * @type {Object}\n         */\n        this.options = {\n            homeHasClass: false,\n            ajaxEnabled: true,\n            pageClass: \"page-content\",\n            objectTypeAttr: \"data-node-type\",\n            noAjaxLinkClass: \"no-ajax-link\",\n            navLinkClass: \"nav-link\",\n            activeClass: \"active\",\n            pageBlockClass: \".page-block\",\n            lazyloadEnabled: false,\n            lazyloadSrcAttr: 'data-src',\n            lazyloadClass: 'lazyload',\n            lazyloadSrcSetAttr: 'data-src-set',\n            $ajaxContainer: $(\"#ajax-container\"),\n            minLoadDuration: 0,\n            preLoadPageDelay: 0,\n            postLoad: (state, data) => {},\n            preLoad: (state) => {},\n            prePushState: (state) => {},\n            onDestroy: () => {},\n            preBoot: ($cont, context, isHome) => {}\n        };\n\n        if (options !== null) {\n            this.options = $.extend(this.options, options);\n        }\n    }\n\n    destroy() {\n        if (this.options.ajaxEnabled) {\n            window.removeEventListener(\"popstate\", this.onPopState.bind(this), false);\n        }\n        const onDestroyBinded = this.options.onDestroy.bind(this);\n        onDestroyBinded();\n    }\n\n    /**\n     * Initialize Router events.\n     *\n     */\n    initEvents() {\n        if (this.options.ajaxEnabled) {\n            window.addEventListener(\"popstate\", this.onPopState.bind(this), false);\n        }\n        /*\n         * Init nav events\n         */\n        this.nav.initEvents(this);\n    }\n    /**\n     * @private\n     * @param  {Event} event\n     * @return\n     */\n    onPopState(event) {\n        if (typeof event.state !== \"undefined\" && event.state !== null) {\n            this.transition = true;\n            this.loadPage(event, event.state);\n        }\n    }\n\n    /**\n     * Booting need a jQuery handler for the jQuery container.\n     *\n     * Call this method in your `main.js` or app entry point **after** creating\n     * the router and calling `initEvents` method.\n     *\n     * @param  {jQuery}  $cont The jQuery DOM element to boot in.\n     * @param  {String}  context [\"static\" or custom string]\n     * @param  {Boolean} isHome\n     */\n    boot($cont, context, isHome) {\n        if(context == 'static') {\n            this.loadBeginDate = new Date();\n        }\n        const preBootBinded = this.options.preBoot.bind(this);\n        preBootBinded($cont, context, isHome);\n\n        const nodeType = $cont.attr(this.options.objectTypeAttr);\n\n        if(isHome && this.options.homeHasClass){\n            this.page = new Home(this, $cont, context, nodeType, isHome);\n        } else {\n            this.page = this.classFactory.getPageInstance(nodeType, this, $cont, context, nodeType, isHome);\n        }\n    }\n\n    /**\n     * @private\n     * @param e Event\n     */\n    onLinkClick(e) {\n        const linkClassName = e.currentTarget.className,\n            linkHref = e.currentTarget.href;\n\n        if(linkHref.indexOf('mailto:') == -1) {\n            e.preventDefault();\n\n            // Check if link is not active\n            if(linkClassName.indexOf(this.options.activeClass) == -1 &&\n               linkClassName.indexOf(this.options.noAjaxLinkClass) == -1 &&\n               !this.transition) {\n                this.transition = true;\n\n                this.state = new State(this, e.currentTarget, {\n                    previousType: this.page.type,\n                    navLinkClass: this.options.navLinkClass\n                });\n\n                const prePushStateBinded = this.options.prePushState.bind(this);\n                prePushStateBinded(this.state);\n\n                if (history.pushState) {\n                    history.pushState(this.state, this.state.title, this.state.href);\n                }\n                this.loadPage(e, this.state);\n            }\n        }\n    }\n\n    /**\n     * Perform a AJAX load for an History event.\n     *\n     * @param e\n     * @param state\n     * @private\n     */\n    loadPage(e, state) {\n        if(this.currentRequest && this.currentRequest.readyState != 4) {\n            this.currentRequest.abort();\n        }\n        this.loader.show();\n        this.loadBeginDate = new Date();\n\n        const preLoadBinded = this.options.preLoad.bind(this);\n        preLoadBinded(state);\n\n        setTimeout(() => {\n            this.currentRequest = $.ajax({\n                url: state.href,\n                dataType: \"html\",\n                // Need to disable cache to prevent\n                // browser to serve partial when no\n                // ajax context is defined.\n                cache: false,\n                type: 'get',\n                success: this._onDataLoaded.bind(this)\n            });\n\n        }, this.options.preLoadPageDelay);\n    }\n\n    /**\n     * @private\n     * @param {Object} data jQuery AJAX response\n     */\n    _onDataLoaded(data) {\n         // Extract only to new page content\n        // if the whole HTML is queried\n        let $data = null;\n        const $response = $($.parseHTML(data.trim()));\n        if ($response.hasClass(this.options.pageClass)) {\n            $data = $response;\n        } else {\n            $data = $response.find('.' + this.options.pageClass);\n        }\n        /*\n         * Display data to DOM\n         */\n        this.options.$ajaxContainer.append($data);\n\n        /*\n         * Push a copy object not to set it as null.\n         */\n        this.formerPages.push(this.page);\n\n        // Init new page\n        this.updatePageTitle($data);\n        this.boot($data, 'ajax', state.isHome);\n\n        const postLoadBinded = this.options.postLoad.bind(this);\n        postLoadBinded(state, $data);\n\n        // Analytics\n        if(typeof ga !== \"undefined\") {\n            ga('send', 'pageview', {'page':state.href, 'title':document.title});\n        }\n    }\n\n    /**\n     * Update page title against data-title attribute\n     * from ajax loaded partial DOM.\n     *\n     * @param {jQuery} $data\n     */\n    updatePageTitle($data){\n        if($data.length && $data.attr('data-meta-title') !== ''){\n            let metaTitle = $data.attr('data-meta-title');\n            if(metaTitle !== null && metaTitle !== '') document.title = metaTitle;\n        }\n    }\n\n    /**\n     *\n     * @param {boolean} isHome\n     */\n    pushFirstState(isHome){\n        if (history.pushState) {\n            history.pushState({\n                'firstPage': true,\n                'href':  window.location.href,\n                'isHome':isHome\n            }, null, window.location.href);\n        }\n    }\n}\n"],"sourceRoot":"/source/"}