{"version":3,"sources":["abstract-page.js"],"names":[],"mappings":"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","file":"abstract-page.js","sourcesContent":["/**\n * Copyright Â© 2016, Ambroise Maupate\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is furnished\n * to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * @file abstract-page.js\n * @author Ambroise Maupate\n */\nimport log from \"loglevel\";\nimport TweenMax from \"TweenMax\";\nimport waitForImages from \"waitForImages\";\nimport $ from \"jquery\";\nimport {debounce} from \"utils/debounce\";\n\nexport class AbstractPage {\n    /**\n     * @param  {Router}  router\n     * @param  {jQuery}  $cont\n     * @param  {String}  context\n     * @param  {String}  type\n     * @param  {Boolean} isHome\n     */\n    constructor(router, $cont, context, type, isHome) {\n        type = type || 'page';\n\n        if (!$cont) {\n            throw \"AbstractPage need a $cont (JQuery) to be defined.\";\n        }\n        if (!router) {\n            throw \"AbstractPage need a Router instance to be defined.\";\n        }\n\n        /**\n         *\n         * @type {Router}\n         */\n        this.router = router;\n        /**\n         *\n         * @type {jQuery}\n         */\n        this.$cont = $cont;\n        /**\n         * @type {String}\n         */\n        this.id = $cont[0].id;\n        /**\n         * @type {String}\n         */\n        this.context = context;\n        /**\n         * @type {String}\n         */\n        this.type = type;\n        /**\n         * @type {Boolean}\n         */\n        this.isHome = isHome;\n\n        if(this.$cont[0].getAttribute('data-is-home') == '1'){\n            this.isHome = true;\n        }\n\n        this.name = (this.$cont.length) ? this.$cont[0].getAttribute('data-node-name') : '';\n\n        this.onResizeDebounce = debounce(this.onResize.bind(this), 50, false);\n\n        log.debug('+ New page : ' + type + ' - #' + this.id);\n\n        this.init();\n        this.initEvents();\n    }\n\n    /**\n     * Initialize page.\n     *\n     * You should always extends this method in your child implemetations.\n     */\n    init() {\n        this.$link = this.$cont.find('a').not('[target=\"_blank\"]');\n        this.bindedLinkClick = this.router.onLinkClick.bind(this.router);\n\n        // Add target blank on external link\n        if(this.$link.length){\n            this.externalLinkTarget(this.$link, this.router.baseUrl);\n            this.$link = this.$cont.find('a').not('[target=\"_blank\"]');\n        }\n\n        // --- Blocks --- //\n        this.blocks = [];\n        this.$blocks = this.$cont.find(this.router.options.pageBlockClass);\n        this.blockLength = this.$blocks.length;\n        if(this.blockLength) {\n            this.initBlocks();\n        }\n\n        // --- Context --- //\n        if(this.context == 'static' && this.router.ajaxEnabled) {\n            this.router.pushFirstState(this.isHome);\n        } else if(this.context == 'ajax'){\n            this.initAjax();\n        }\n    }\n\n    /**\n     *\n     */\n    destroy() {\n        log.debug('destroy:' + this.id);\n        this.$cont.remove();\n        this.destroyEvents();\n        // --- Blocks --- //\n        if (this.blocks !== null) {\n            for (var blockIndex in this.blocks) {\n                this.blocks[blockIndex].destroy();\n            }\n        }\n    }\n\n    /**\n     * Initialize basic events.\n     *\n     * Such as waitForImages and link click if you enabled Ajax navigation.\n     */\n    initEvents() {\n        if (this.$cont.find('img').length) {\n            this.$cont.waitForImages({\n                finished: this.onLoad.bind(this),\n                waitForAll: true\n            });\n        } else {\n            this.onLoad();\n        }\n\n        if(this.$link.length && this.router.options.ajaxEnabled) {\n            this.$link.on('click', this.bindedLinkClick);\n        }\n\n        this.router.$window.on('resize', this.onResizeDebounce);\n    }\n\n    /**\n     *\n     */\n    destroyEvents() {\n        this.$link.off('click', this.bindedLinkClick);\n        this.router.$window.off('resize', this.onResizeDebounce);\n    }\n\n    /**\n     * @param e\n     * @private\n     */\n    onLoad(e) {\n        this.loadDate = new Date();\n        this.loadDuration = this.loadDate - this.router.loadBeginDate;\n\n        this.router.nav.update(this);\n\n        const delay = (this.loadDuration > this.router.options.minLoadDuration) ? 0 : this.router.options.minLoadDuration - this.loadDuration;\n\n        // Hide loading\n        setTimeout(() => {\n            const onShowEnded = this.showEnded.bind(this);\n\n            this.router.loader.hide();\n\n            if(this.context == 'static'){\n                this.show(onShowEnded);\n            } else if(this.context == 'ajax'){\n                // Update body id\n                if(this.name !== '') document.body.id = this.name;\n                // $('body').get(0).id = history.state.nodeName;\n                // Hide formerPages - show\n                if (this.router.formerPages.length > 0) {\n                    const formerPage = this.router.formerPages[(this.router.formerPages.length - 1)];\n                    const formerPageDestroy = formerPage.destroy.bind(formerPage);\n\n                    /*\n                     * Very important,\n                     * DO NOT animate if there are more than 1 page\n                     * in destroy queue!\n                     */\n                    if (this.router.formerPages.length > 1) {\n                        formerPageDestroy();\n                    } else {\n                        formerPage.hide(formerPageDestroy);\n                    }\n                    this.router.formerPages.pop();\n                }\n\n                this.show(onShowEnded);\n            }\n        }, delay);\n    }\n\n    /**\n     * @param {Function} onShow\n     */\n    show(onShow) {\n        log.debug('>>>> Show ----');\n        // Animate\n        var tween = TweenLite.to(this.$cont, 0.6, {'opacity':1, onComplete: () => {\n            this.router.transition = false;\n            if (typeof onShow !== 'undefined') {\n                onShow();\n            }\n        }});\n    }\n\n    /**\n     *\n     */\n    showEnded() {\n        log.debug('---- Show >>>>');\n        this.$cont.removeClass(this.router.options.pageClass + '-ajax');\n        this.$cont.removeClass(this.router.options.pageClass + '-transitioning');\n    }\n\n    /**\n     * @param {Function} onHidden\n     */\n    hide(onHidden) {\n        log.debug('hiding:' + this.id);\n        TweenLite.to(this.$cont, 0.6, {opacity:0, onComplete:onHidden});\n    }\n\n    initAjax() {\n        this.$cont.addClass(this.router.options.pageClass + '-transitioning');\n    }\n\n    /**\n     * @private\n     */\n    initBlocks() {\n        for(let blockIndex = 0; blockIndex < this.blockLength; blockIndex++) {\n\n            let type = this.$blocks[blockIndex].getAttribute('data-node-type'),\n                id = this.$blocks[blockIndex].id;\n\n            this.blocks[blockIndex] = this.router.classFactory.getBlockInstance(type, this, this.$blocks.eq(blockIndex));\n        }\n    }\n\n    /**\n     * @param  {String} id\n     * @return {AbstractBlock|null}\n     */\n    getBlockById(id) {\n        for (let i in this.blocks) {\n            if (this.blocks[i].id == id) {\n                return this.blocks[i];\n            }\n        }\n        return null;\n    }\n\n    /**\n     *\n     */\n    onResize(){\n\n    }\n\n    /**\n     * Add target blank to external links.\n     *\n     * @param  {JQuery} $links\n     * @param  {String} baseUrl\n     */\n    externalLinkTarget($links, baseUrl) {\n        const linksLength = $links.length;\n        let abstractBaseUrl = baseUrl.split('://');\n\n        abstractBaseUrl = abstractBaseUrl[1];\n\n        for(let linkIndex = 0; linkIndex < linksLength; linkIndex++){\n            const link = $links[linkIndex];\n            if(link.href.indexOf(abstractBaseUrl) == -1 &&\n               link.href.indexOf('javascript') == -1 &&\n               link.href.indexOf('mailto:') == -1 &&\n               link.href.charAt(0) != '/' &&\n               link.href.charAt(0) != '#')\n            {\n                $links[linkIndex].target = '_blank';\n            }\n        }\n    }\n}\n"],"sourceRoot":"/source/"}